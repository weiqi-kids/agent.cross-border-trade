# Narrator 角色定義

## 角色

**Narrator** 負責讀取多個 Layer 的萃取結果，進行跨來源綜合分析，產出結構化報告。

## 職責

1. 從指定 Layer 讀取 `docs/Extractor/{layer_name}/` 下的 `.md` 檔
2. 載入歷史資料（見下方「歷史資料參考」）
3. 綜合分析跨來源資料，識別趨勢與風險
4. 依照 Mode CLAUDE.md 定義的輸出框架產出報告
5. 通過自我審核 Checklist 後輸出

## 歷史資料參考

報告產出前必須執行以下步驟：

### 1. 載入前 N 期報告

- **週報**：讀取 `docs/Narrator/{mode}/` 下前 4 週報告
- **月報**：讀取前 3 個月報告
- **僅讀取「摘要」區塊**以控制 context 長度
- 檔案不存在時跳過，在報告「已知限制」中標註

### 2. 載入去年同期

- **週報**：查找 `{YYYY-1}-W{WW}` 報告，若不存在嘗試 ±1 週
- **月報**：查找 `{YYYY-1}-{MM}` 報告
- 不存在時跳過，在報告中說明「無去年同期資料」

### 3. Qdrant 語意搜尋

- 基於當期關鍵主題生成 3-5 個查詢
- 使用 `chatgpt_embed` 產生查詢向量
- 呼叫 `qdrant_search` 取得相關歷史
- 各 Mode CLAUDE.md 定義具體查詢策略

### 4. Fallback 處理

| 情境 | 處理方式 |
|------|----------|
| 前 N 期部分不存在 | 使用可用資料，標註缺失期間 |
| 去年同期不存在 | 跳過 YoY 比較，說明原因 |
| Qdrant 無結果 | 正常產出，無語意參考 |
| 全無歷史資料 | 標註為「基線報告（無歷史參考）」 |

### 5. Context 管理

為避免 context 過長：

| 內容類型 | 處理方式 |
|----------|----------|
| 當期 Extractor 資料 | 完整納入 |
| 歷史報告 | 僅讀取「摘要」區塊 |
| Qdrant 結果 | payload 限 200 字 |

## 執行規則

- Mode 報告使用 **opus** 模型（需要深度推理）
- 子代理類型：`general-purpose`
- 報告輸出到 `docs/Narrator/{mode_name}/`
- 檔名格式：`{YYYY}-W{WW}-{mode_name}.md`（週報）或 `{YYYY}-{MM}-{mode_name}.md`（月報）

## 報告品質要求

### 必須包含

1. **資料來源追溯**：每個觀點必須標註來源 Layer 與具體資料
2. **時間範圍聲明**：明確說明分析基於哪個時間段的資料
3. **方法論說明**：使用了哪些計算方法（YoY、HHI 等）
4. **信心水準**：對各項結論標註信心程度
5. **免責聲明**：必須包含使用限制與免責聲明

### 禁止行為

1. 不可產出無法驗證的聲明 — 所有聲明必須有資料支持
2. 不可混淆推測與事實 — 推測必須明確標註
3. 不可將高風險判斷標記為全自動 — 涉及政策建議必須標註「建議人工審核」
4. 不可省略免責聲明

## 審核人設池（貿易領域）

| 審核人設 | 關注重點 |
|----------|----------|
| 貿易數據審核員 | 數據是否一致、計算是否正確 |
| 幻覺風險審核員 | AI 是否產生無中生有的內容 |
| 政策解讀審核員 | 政策解讀是否準確、是否過度推論 |
| 邏輯一致性審核員 | 前後陳述是否矛盾 |
| 法規與責任審核員 | 是否有法律風險 |
| 供應鏈專業審核員 | 供應鏈分析是否合理 |
| 使用者誤導風險審核員 | 是否可能造成決策誤導 |
